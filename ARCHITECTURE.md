# ğŸ—ï¸ å°ˆæ¡ˆæ¶æ§‹èªªæ˜

æœ¬æ–‡ä»¶è©³ç´°èªªæ˜çµé¢¨ç”·åœ˜å°ˆæ¡ˆçš„æŠ€è¡“æ¶æ§‹å’Œè¨­è¨ˆæ±ºç­–ã€‚

---

## ğŸ“ ç›®éŒ„çµæ§‹

```
wind-hunter/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ api/                  # API Routes
â”‚   â”‚   â”œâ”€â”€ chat/            # å°è©± API
â”‚   â”‚   â””â”€â”€ voice-webhook/   # ElevenLabs Webhook
â”‚   â”œâ”€â”€ wind/                # é¢¨æ„Ÿè€…ä¸»é 
â”‚   â”œâ”€â”€ auth/                # èªè­‰é é¢
â”‚   â””â”€â”€ page.tsx             # é¦–é 
â”œâ”€â”€ components/              # React å…ƒä»¶
â”‚   â”œâ”€â”€ chat/               # èŠå¤©ç›¸é—œå…ƒä»¶
â”‚   â”œâ”€â”€ character/          # è§’è‰²ç›¸é—œå…ƒä»¶
â”‚   â””â”€â”€ ui/                 # é€šç”¨ UI å…ƒä»¶
â”œâ”€â”€ lib/                     # æ ¸å¿ƒé‚è¼¯åº«
â”‚   â”œâ”€â”€ wind-engine/        # å¿ƒé¢¨ç®—æ³•å¼•æ“
â”‚   â”œâ”€â”€ tone-router/        # ä¸‰ç”·ç¥è·¯ç”±å™¨
â”‚   â”œâ”€â”€ delay-scheduler/    # å»¶é²æ’ç¨‹ç³»çµ±
â”‚   â”œâ”€â”€ chatkit/            # ChatKit é›†æˆ
â”‚   â””â”€â”€ voice/              # èªéŸ³è™•ç†
â”œâ”€â”€ supabase/               # Supabase ç›¸é—œ
â”‚   â””â”€â”€ schema.sql          # è³‡æ–™åº« Schema
â”œâ”€â”€ public/                 # éœæ…‹è³‡æº
â”œâ”€â”€ .env.example            # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ next.config.js
â””â”€â”€ README.md
```

---

## ğŸ§© æ ¸å¿ƒæ¨¡çµ„èªªæ˜

### 1. å¿ƒé¢¨ç®—æ³•å¼•æ“ (`lib/wind-engine`)

**è·è²¬ï¼š** æ ¹æ“šä½¿ç”¨è€…æƒ…ç·’ç‹€æ…‹åˆ¤å®šå¿ƒé¢¨éšæ®µ

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æƒ…ç·’åˆ†æï¼ˆå¾å°è©±æ–‡å­—æ¨æ¸¬ï¼‰
- å¿ƒé¢¨éšæ®µè¨ˆç®—ï¼ˆæš–é¢¨/éœé¢¨/äº‚é¢¨ï¼‰
- æœªä¾†å¯æ¥å…¥ AI æƒ…ç·’åˆ†æ API

**ä¸»è¦å‡½æ•¸ï¼š**
```typescript
computeWindPhase(userEmotion: UserEmotion): WindPhase
analyzeEmotionFromText(text: string): UserEmotion
```

---

### 2. ä¸‰ç”·ç¥è·¯ç”±å™¨ (`lib/tone-router`)

**è·è²¬ï¼š** æ ¹æ“šå¿ƒé¢¨éšæ®µæ±ºå®šç”±å“ªä½ç”·ç¥å›æ‡‰

**è§’è‰²è¨­å®šï¼š**
- **æº«æ™¯** - æš–é¢¨éšæ®µï¼Œæº«æš–åŒ…å®¹
- **å¯’å·** - éœé¢¨éšæ®µï¼Œæ²‰ç©©å¯é 
- **é‡é»** - äº‚é¢¨éšæ®µï¼Œæ´»æ½‘æœ‰è¶£

**ä¸»è¦å‡½æ•¸ï¼š**
```typescript
routeCharacter(phase: WindPhase): Character
getSystemPrompt(character: Character): string
getVoiceId(character: Character): string
```

---

### 3. å»¶é²æ’ç¨‹ç³»çµ± (`lib/delay-scheduler`)

**è·è²¬ï¼š** ç®¡ç†å»¶é²è¨Šæ¯çš„æ’ç¨‹å’ŒåŸ·è¡Œ

**æ”¯æ´æƒ…å¢ƒï¼š**
- é–‹æœƒä¸­ï¼ˆ5-15åˆ†é˜ï¼‰
- é–‹è»Šä¸­ï¼ˆ3-10åˆ†é˜ï¼‰
- é›»æ¢¯è¨Šè™Ÿä¸å¥½ï¼ˆ1-3åˆ†é˜ï¼‰
- æ´—æ¾¡/å¥èº«ï¼ˆ20-30åˆ†é˜ï¼‰
- æ·±å¤œæ³¢æ®µï¼ˆ3-6å°æ™‚ï¼‰

**ä¸»è¦å‡½æ•¸ï¼š**
```typescript
scheduleVoiceTask(payload): Promise<DelayTask>
getPendingTasks(): Promise<DelayTask[]>
updateTaskStatus(taskId, status): Promise<void>
```

---

### 4. ChatKit é›†æˆ (`lib/chatkit`)

**è·è²¬ï¼š** ä½¿ç”¨ OpenAI ChatKit ç”Ÿæˆå°è©±å…§å®¹

**åŠŸèƒ½ï¼š**
- è§’è‰²ä¸€è‡´æ€§å°è©±ç”Ÿæˆ
- æ”¯æ´å°è©±æ­·å²
- å»¶é²å›æ‡‰ç”Ÿæˆ

**ä¸»è¦å‡½æ•¸ï¼š**
```typescript
generateWindMessage(params): Promise<string>
generateDelayedResponse(params): Promise<{...}>
```

---

## ğŸ”„ è³‡æ–™æµç¨‹

### ä½¿ç”¨è€…ç™¼é€è¨Šæ¯æµç¨‹

```
1. ä½¿ç”¨è€…è¼¸å…¥è¨Šæ¯
   â†“
2. Frontend ç™¼é€åˆ° /api/chat
   â†“
3. åˆ†ææƒ…ç·’ â†’ è¨ˆç®—å¿ƒé¢¨éšæ®µ
   â†“
4. è·¯ç”±åˆ°å°æ‡‰ç”·ç¥
   â†“
5. ChatKit ç”Ÿæˆå›æ‡‰æ–‡å­—
   â†“
6. æ±ºå®šæ˜¯å¦å»¶é²
   â”œâ”€ ç«‹å³å›æ‡‰ â†’ ç›´æ¥è¿”å›
   â””â”€ å»¶é²å›æ‡‰ â†’ å»ºç«‹æ’ç¨‹ä»»å‹™
      â†“
7. æ’ç¨‹ä»»å‹™åˆ°æœŸ â†’ å‘¼å« ElevenLabs
   â†“
8. ElevenLabs å®Œæˆ â†’ Webhook å›å‚³
   â†“
9. å„²å­˜èªéŸ³åˆ° Supabase Storage
   â†“
10. å‰ç«¯æ¥æ”¶ä¸¦æ’­æ”¾
```

---

## ğŸ—„ï¸ è³‡æ–™åº«è¨­è¨ˆ

### Tables

#### `profiles`
- ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™
- é¢¨æ„Ÿè€…å®‡å®™ ID
- ç•¶å‰å¿ƒé¢¨éšæ®µ

#### `conversations`
- å°è©±è¨˜éŒ„ï¼ˆæ–‡å­— + èªéŸ³ï¼‰
- é—œè¯ä½¿ç”¨è€…å’Œè§’è‰²
- è¨˜éŒ„ç•¶æ™‚çš„å¿ƒé¢¨éšæ®µ

#### `scheduled_tasks`
- å»¶é²ä»»å‹™æ’ç¨‹
- ç‹€æ…‹è¿½è¹¤
- éŒ¯èª¤è™•ç†

### Storage Buckets

- `avatars` - ä½¿ç”¨è€…é ­åƒ
- `voice-messages` - èªéŸ³è¨Šæ¯
- `character-assets` - è§’è‰²è³‡æº

---

## ğŸ” å®‰å…¨æ€§è¨­è¨ˆ

### Row Level Security (RLS)

æ‰€æœ‰è³‡æ–™è¡¨éƒ½å•Ÿç”¨ RLSï¼Œç¢ºä¿ï¼š
- ä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™
- é˜²æ­¢è·¨ä½¿ç”¨è€…è³‡æ–™æ´©æ¼

### API å®‰å…¨

- NextAuth è™•ç†èªè­‰
- API Routes é©—è­‰ä½¿ç”¨è€…èº«ä»½
- Webhook ä½¿ç”¨ Secret é©—è­‰

---

## ğŸš€ éƒ¨ç½²æ¶æ§‹

### Railway éƒ¨ç½²

```
GitHub Repo
    â†“ (Push)
Railway CI/CD
    â†“ (Auto Deploy)
Next.js Server
    â†“
Cron Worker (æ¯åˆ†é˜)
    â†“
åŸ·è¡Œå¾…è™•ç†çš„å»¶é²ä»»å‹™
```

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

- é–‹ç™¼ç’°å¢ƒï¼š`.env.local`
- ç”Ÿç”¢ç’°å¢ƒï¼šRailway Dashboard

---

## ğŸ¨ å‰ç«¯æ¶æ§‹ï¼ˆå¾…å¯¦ä½œï¼‰

### æŠ€è¡“æ£§

- **æ¡†æ¶ï¼š** Next.js 14 (App Router)
- **æ¨£å¼ï¼š** Tailwind CSS
- **ç‹€æ…‹ç®¡ç†ï¼š** React Hooks + Context
- **å³æ™‚é€šè¨Šï¼š** Supabase Realtime

### ä¸»è¦é é¢

1. **é¦–é ** - å°ˆæ¡ˆä»‹ç´¹
2. **ç™»å…¥é ** - LINE/GitHub ç™»å…¥
3. **é¢¨æ„Ÿè€…ä¸»é ** - å°è©±ä»‹é¢
4. **è§’è‰²è§£é–** - ä¸‰ç”·ç¥é€²åº¦

---

## ğŸ”§ é–‹ç™¼å·¥å…·

### æ¨è–¦ VSCode æ“´å……

- ESLint
- Prettier
- Tailwind CSS IntelliSense
- TypeScript Vue Plugin (Volar)

### ç¨‹å¼ç¢¼å“è³ª

```bash
# å‹åˆ¥æª¢æŸ¥
pnpm type-check

# Lint
pnpm lint

# æ ¼å¼åŒ–
pnpm format
```

---

## ğŸ“Š æ•ˆèƒ½å„ªåŒ–

### å‰ç«¯

- åœ–ç‰‡å„ªåŒ–ï¼ˆNext.js Imageï¼‰
- ç¨‹å¼ç¢¼åˆ†å‰²
- èªéŸ³æª”å¿«å–

### å¾Œç«¯

- API Response å¿«å–
- è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–
- Webhook éåŒæ­¥è™•ç†

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥ï¼ˆå¾…å¯¦ä½œï¼‰

### å–®å…ƒæ¸¬è©¦

- å¿ƒé¢¨ç®—æ³•é‚è¼¯
- è·¯ç”±å™¨é‚è¼¯
- å»¶é²æ’ç¨‹é‚è¼¯

### æ•´åˆæ¸¬è©¦

- API Routes
- Webhook è™•ç†
- è³‡æ–™åº«æ“ä½œ

### E2E æ¸¬è©¦

- å®Œæ•´å°è©±æµç¨‹
- å»¶é²è¨Šæ¯æµç¨‹
- ç™»å…¥æµç¨‹

---

## ğŸ”® æœªä¾†è¦åŠƒ

### Phase 1ï¼ˆMVPï¼‰
- âœ… æ ¸å¿ƒæ¶æ§‹
- â³ åŸºæœ¬å°è©±åŠŸèƒ½
- â³ ä¸‰ç”·ç¥åˆ‡æ›
- â³ èªéŸ³ç”Ÿæˆ

### Phase 2
- â³ å»¶é²è¨Šæ¯ç³»çµ±
- â³ LINE ç™»å…¥
- â³ è§’è‰²è§£é–æ©Ÿåˆ¶

### Phase 3
- â³ AI æƒ…ç·’åˆ†æ
- â³ å€‹æ€§åŒ–æ¨è–¦
- â³ ç¤¾ç¾¤åŠŸèƒ½

---

**æŒçºŒæ›´æ–°ä¸­... ğŸŒ¬ï¸**
